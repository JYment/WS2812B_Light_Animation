/*
 * GccApplication1.c
 *
 * Created: 2019-11-05 오후 9:32:09
 * Author : JY
 */ 
#define F_CPU		16000000UL

#include <avr/io.h>
#include <avr/interrupt.h>
#include <stdio.h>
#include <stdlib.h>
#include <util/delay.h>
#include "ATmega328_USART.h"
#include "light_ws2812.h"

#define MAIN_BTN		(PIND&0x04)
#define LED_BTN			(PIND&0x08)
#define TIMER_BTN		(PIND&0x10)

#define LED_NUM			110

#define MODE_DEFAULT	0

#define TIME_SET_A		5
#define TIME_SET_B		10



volatile unsigned int cnt = 0;
volatile unsigned char main_btn_flag = 0, led_btn_flag = 0, timer_btn_flag = 0;
volatile unsigned char main_btn_cnt = 0, led_btn_cnt = 0, timer_btn_cnt = 0;
volatile unsigned char main_btn_mode = 0, led_btn_mode = 0, timer_btn_mode = 0;
volatile unsigned char dimming_mode = 0, dimming = 1, dimming_cnt = 0;
volatile unsigned char time_cnt = 0, time_sec = 0, time_min = 0;
struct cRGB led[110];
char led_tbl[440][2] = {
// 	{255,150},{253,149},{250,147},{248,146},{246,145},{243,143},{241,142},{239,140},{236,139},{234,138},
// 	{232,136},{230,135},{227,134},{225,132},{223,131},{220,130},{218,128},{216,127},{213,125},{211,124},
// 	{209,123},{206,121},{204,120},{202,119},{199,117},{197,116},{195,115},{192,113},{190,112},{188,110},
// 	{185,109},{183,108},{181,106},{179,105},{176,104},{174,102},{172,101},{169,100},{167,98},{165,97},
// 	{162,95},{160,94},{158,93},{155,91},{153,90},{151,89},{148,87},{146,86},{144,85},{141,83},
// 	{139,82},{137,80},{134,79},{132,78},{130,76},{128,75},{125,74},{123,72},{121,71},{118,70},
// 	{116,68},{114,67},{111,65},{109,64},{107,63},{104,61},{102,60},{100,59},{97,57},{95,56},
// 	{93,55},{90,53},{88,52},{86,50},{83,49},{81,48},{79,46},{77,45},{74,44},{72,42},
// 	{70,41},{67,40},{65,38},{63,37},{60,35},{58,34},{56,33},{53,31},{51,30},{49,29},
// 	{46,27},{44,26},{42,25},{39,23},{37,22},{35,20},{32,19},{30,18},{28,16},{26,15},
// 	{23,14},{21,12},{19,11},{16,10},{14,8},{12,7},{9,5},{7,4},{5,3},{2,1},
// 	//
// 	{255,150},{253,149},{250,147},{248,146},{246,145},{243,143},{241,142},{239,140},{236,139},{234,138},
// 	{232,136},{230,135},{227,134},{225,132},{223,131},{220,130},{218,128},{216,127},{213,125},{211,124},
// 	{209,123},{206,121},{204,120},{202,119},{199,117},{197,116},{195,115},{192,113},{190,112},{188,110},
// 	{185,109},{183,108},{181,106},{179,105},{176,104},{174,102},{172,101},{169,100},{167,98},{165,97},
// 	{162,95},{160,94},{158,93},{155,91},{153,90},{151,89},{148,87},{146,86},{144,85},{141,83},
// 	{139,82},{137,80},{134,79},{132,78},{130,76},{128,75},{125,74},{123,72},{121,71},{118,70},
// 	{116,68},{114,67},{111,65},{109,64},{107,63},{104,61},{102,60},{100,59},{97,57},{95,56},
// 	{93,55},{90,53},{88,52},{86,50},{83,49},{81,48},{79,46},{77,45},{74,44},{72,42},
// 	{70,41},{67,40},{65,38},{63,37},{60,35},{58,34},{56,33},{53,31},{51,30},{49,29},
// 	{46,27},{44,26},{42,25},{39,23},{37,22},{35,20},{32,19},{30,18},{28,16},{26,15},
// 	{23,14},{21,12},{19,11},{16,10},{14,8},{12,7},{9,5},{7,4},{5,3},{2,1},
		
	{2,1},{5,3},{7,4},{9,5},{12,7},{14,8},{16,10},{19,11},{21,12},{23,14},
	{26,15},{28,16},{30,18},{32,19},{35,20},{37,22},{39,23},{42,25},{44,26},{46,27},
	{49,29},{51,30},{53,31},{56,33},{58,34},{60,35},{63,37},{65,38},{67,40},{70,41},
	{72,42},{74,44},{77,45},{79,46},{81,48},{83,49},{86,50},{88,52},{90,53},{93,55},
	{95,56},{97,57},{100,59},{102,60},{104,61},{107,63},{109,64},{111,65},{114,67},{116,68},
	{118,70},{121,71},{123,72},{125,74},{128,75},{130,76},{132,78},{134,79},{137,80},{139,82},
	{141,83},{144,85},{146,86},{148,87},{151,89},{153,90},{155,91},{158,93},{160,94},{162,95},
	{165,97},{167,98},{169,100},{172,101},{174,102},{176,104},{179,105},{181,106},{183,108},{185,109},
	{188,110},{190,112},{192,113},{195,115},{197,116},{199,117},{202,119},{204,120},{206,121},{209,123},
	{211,124},{213,125},{216,127},{218,128},{220,130},{223,131},{225,132},{227,134},{230,135},{232,136},
	{234,138},{236,139},{239,140},{241,142},{243,143},{246,145},{248,146},{250,147},{253,149},{255,150},
		
	{2,1},{5,3},{7,4},{9,5},{12,7},{14,8},{16,10},{19,11},{21,12},{23,14},
	{26,15},{28,16},{30,18},{32,19},{35,20},{37,22},{39,23},{42,25},{44,26},{46,27},
	{49,29},{51,30},{53,31},{56,33},{58,34},{60,35},{63,37},{65,38},{67,40},{70,41},
	{72,42},{74,44},{77,45},{79,46},{81,48},{83,49},{86,50},{88,52},{90,53},{93,55},
	{95,56},{97,57},{100,59},{102,60},{104,61},{107,63},{109,64},{111,65},{114,67},{116,68},
	{118,70},{121,71},{123,72},{125,74},{128,75},{130,76},{132,78},{134,79},{137,80},{139,82},
	{141,83},{144,85},{146,86},{148,87},{151,89},{153,90},{155,91},{158,93},{160,94},{162,95},
	{165,97},{167,98},{169,100},{172,101},{174,102},{176,104},{179,105},{181,106},{183,108},{185,109},
	{188,110},{190,112},{192,113},{195,115},{197,116},{199,117},{202,119},{204,120},{206,121},{209,123},
	{211,124},{213,125},{216,127},{218,128},{220,130},{223,131},{225,132},{227,134},{230,135},{232,136},
	{234,138},{236,139},{239,140},{241,142},{243,143},{246,145},{248,146},{250,147},{253,149},{255,150}		
	//
};
/*char led_tbl[440][2] = {
	{255,255 },{242,242 },{230,230 },{219,219 },{208,208 },{197,197 },{187,187 },{178,178 },{169,169 },{161,161 },
	{153,153 },{145,145 },{138,138 },{131,131 },{124,124 },{118,118 },{112,112 },{107,107 },{101,101 },{ 96, 96 },
	{ 91, 91 },{ 87, 87 },{ 83, 83 },{ 78, 78 },{ 74, 74 },{ 71, 71 },{ 67, 67 },{ 64, 64 },{ 61, 61 },{ 58, 58 },
	{ 55, 55 },{ 52, 52 },{ 49, 49 },{ 47, 47 },{ 45, 45 },{ 42, 42 },{ 40, 40 },{ 38, 38 },{ 36, 36 },{ 34, 34 },
	{ 33, 33 },{ 31, 31 },{ 30, 30 },{ 28, 28 },{ 27, 27 },{ 25, 25 },{ 24, 24 },{ 23, 23 },{ 22, 22 },{ 21, 21 },
	{ 20, 20 },{ 19, 19 },{ 18, 18 },{ 17, 17 },{ 16, 16 },{ 15, 15 },{ 14, 14 },{ 14, 14 },{ 13, 13 },{ 12, 12 },
	{ 12, 12 },{ 11, 11 },{ 10, 10 },{  9,  9 },{  9,  9 },{  8,  8 },{  7,  7 },{  7,  7 },{  7,  7 },{  6,  6 },
	{  6,  6 },{  6,  6 },{  5,  5 },{  5,  5 },{  5,  5 },{  5,  5 },{  4,  4 },{  4,  4 },{  4,  4 },{  4,  4 },
	{  4,  4 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  2,  2 },{  2,  2 },
	{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  1,  1 },{  1,  1 },
	{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },
	//
	{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },
	{  1,  1 },{  1,  1 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },
	{  2,  2 },{  2,  2 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  4,  4 },
	{  4,  4 },{  4,  4 },{  4,  4 },{  4,  4 },{  5,  5 },{  5,  5 },{  5,  5 },{  5,  5 },{  6,  6 },{  6,  6 },
	{  6,  6 },{  7,  7 },{  7,  7 },{  7,  7 },{  8,  8 },{  9,  9 },{  9,  9 },{ 10, 10 },{ 11, 11 },{ 12, 12 },
	{ 12, 12 },{ 13, 13 },{ 14, 14 },{ 14, 14 },{ 15, 15 },{ 16, 16 },{ 17, 17 },{ 18, 18 },{ 19, 19 },{ 20, 20 },
	{ 21, 21 },{ 22, 22 },{ 23, 23 },{ 24, 24 },{ 25, 25 },{ 27, 27 },{ 28, 28 },{ 30, 30 },{ 31, 31 },{ 33, 33 },
	{ 34, 34 },{ 36, 36 },{ 38, 38 },{ 40, 40 },{ 42, 42 },{ 45, 45 },{ 47, 47 },{ 49, 49 },{ 52, 52 },{ 55, 55 },
	{ 58, 58 },{ 61, 61 },{ 64, 64 },{ 67, 67 },{ 71, 71 },{ 74, 74 },{ 78, 78 },{ 83, 83 },{ 87, 87 },{ 91, 91 },
	{ 96, 96 },{101,101 },{107,107 },{112,112 },{118,118 },{124,124 },{131,131 },{138,138 },{145,145 },{153,153 },
	{161,161 },{169,169 },{178,178 },{187,187 },{197,197 },{208,208 },{219,219 },{230,230 },{242,242 },{255,255 },
	//
	{255,255 },{242,242 },{230,230 },{219,219 },{208,208 },{197,197 },{187,187 },{178,178 },{169,169 },{161,161 },
	{153,153 },{145,145 },{138,138 },{131,131 },{124,124 },{118,118 },{112,112 },{107,107 },{101,101 },{ 96, 96 },
	{ 91, 91 },{ 87, 87 },{ 83, 83 },{ 78, 78 },{ 74, 74 },{ 71, 71 },{ 67, 67 },{ 64, 64 },{ 61, 61 },{ 58, 58 },
	{ 55, 55 },{ 52, 52 },{ 49, 49 },{ 47, 47 },{ 45, 45 },{ 42, 42 },{ 40, 40 },{ 38, 38 },{ 36, 36 },{ 34, 34 },
	{ 33, 33 },{ 31, 31 },{ 30, 30 },{ 28, 28 },{ 27, 27 },{ 25, 25 },{ 24, 24 },{ 23, 23 },{ 22, 22 },{ 21, 21 },
	{ 20, 20 },{ 19, 19 },{ 18, 18 },{ 17, 17 },{ 16, 16 },{ 15, 15 },{ 14, 14 },{ 14, 14 },{ 13, 13 },{ 12, 12 },
	{ 12, 12 },{ 11, 11 },{ 10, 10 },{  9,  9 },{  9,  9 },{  8,  8 },{  7,  7 },{  7,  7 },{  7,  7 },{  6,  6 },
	{  6,  6 },{  6,  6 },{  5,  5 },{  5,  5 },{  5,  5 },{  5,  5 },{  4,  4 },{  4,  4 },{  4,  4 },{  4,  4 },
	{  4,  4 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  2,  2 },{  2,  2 },
	{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  1,  1 },{  1,  1 },
	{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },
	//
	{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },{  1,  1 },
	{  1,  1 },{  1,  1 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },{  2,  2 },
	{  2,  2 },{  2,  2 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  3,  3 },{  4,  4 },
	{  4,  4 },{  4,  4 },{  4,  4 },{  4,  4 },{  5,  5 },{  5,  5 },{  5,  5 },{  5,  5 },{  6,  6 },{  6,  6 },
	{  6,  6 },{  7,  7 },{  7,  7 },{  7,  7 },{  8,  8 },{  9,  9 },{  9,  9 },{ 10, 10 },{ 11, 11 },{ 12, 12 },
	{ 12, 12 },{ 13, 13 },{ 14, 14 },{ 14, 14 },{ 15, 15 },{ 16, 16 },{ 17, 17 },{ 18, 18 },{ 19, 19 },{ 20, 20 },
	{ 21, 21 },{ 22, 22 },{ 23, 23 },{ 24, 24 },{ 25, 25 },{ 27, 27 },{ 28, 28 },{ 30, 30 },{ 31, 31 },{ 33, 33 },
	{ 34, 34 },{ 36, 36 },{ 38, 38 },{ 40, 40 },{ 42, 42 },{ 45, 45 },{ 47, 47 },{ 49, 49 },{ 52, 52 },{ 55, 55 },
	{ 58, 58 },{ 61, 61 },{ 64, 64 },{ 67, 67 },{ 71, 71 },{ 74, 74 },{ 78, 78 },{ 83, 83 },{ 87, 87 },{ 91, 91 },
	{ 96, 96 },{101,101 },{107,107 },{112,112 },{118,118 },{124,124 },{131,131 },{138,138 },{145,145 },{153,153 },
	{161,161 },{169,169 },{178,178 },{187,187 },{197,197 },{208,208 },{219,219 },{230,230 },{242,242 },{255,255 }
};*/

char temp[40];

ISR(TIMER0_COMPA_vect)
{
	time_cnt++;
	if(time_cnt%20 == 0)		PORTB ^= (1 << PORTB5);
	if(time_cnt == 100)
	{
		time_sec++;
		time_cnt = 0;
	}
	if(time_sec == 60)
	{
		time_min++;
		time_sec = 0;
	}
	
	if(main_btn_mode == 1)
	{
		if(timer_btn_mode == 1)
		{
			if(time_min == TIME_SET_A)
			{
				sprintf(temp, "--- main_mode  :  %dmin OFF  ---\n", time_min);
				USART_Transmit_str(temp, _ASCII);
				main_btn_mode  = MODE_DEFAULT;
				led_btn_mode   = MODE_DEFAULT;
				timer_btn_mode = MODE_DEFAULT;
			}
		}
		else if(timer_btn_mode == 2)
		{
			if(time_min == TIME_SET_B)
			{
				sprintf(temp, "--- main_mode  :  %dmin OFF  ---\n", time_min);
				USART_Transmit_str(temp, _ASCII);
				main_btn_mode  = MODE_DEFAULT;
				led_btn_mode   = MODE_DEFAULT;
				timer_btn_mode = MODE_DEFAULT;
			}
		}
	}
	
	if(main_btn_mode == 0 && led_btn_mode == 0 && timer_btn_mode == 0)	PORTB &= ~(1 << PORTB5);
}

ISR(TIMER1_COMPA_vect)
{
	// ************************** MAIN_BTN PROCESS ************************** //
// 	sprintf(temp, "--- Now dimming = %d\n", dimming);
// 	USART_Transmit_str(temp, _ASCII);
	
	if(!MAIN_BTN)
	{
		if(main_btn_flag == 0)
		{
			main_btn_flag = 1;
			main_btn_cnt = 0;
		}
		else
		{
			if(main_btn_cnt < 60)	main_btn_cnt++;
		}
	}
	else
	{
		main_btn_flag = 0;
		if(main_btn_cnt)
		{
			if(main_btn_cnt >= 20)		// main_btn 길게 누름
			{
				// Bluetooth ON
				if(main_btn_mode == 1)
				{
					sprintf(temp, "--- main_btn_mode  :  Bluetooth ON ---\n");
					USART_Transmit_str(temp, _ASCII);
				}
			}
			else								// main_btn 짧게 누름
			{
				if(main_btn_mode == 0)
				{
					main_btn_mode = 1;			// 전원 ON
					led_btn_mode = 1;			// led mode = ON
					dimming = 1;
					sprintf(temp, "--- main_mode  :  ON  ---\n");
				}
				else 
				{
					main_btn_mode  = MODE_DEFAULT;
					led_btn_mode   = MODE_DEFAULT;
					timer_btn_mode = MODE_DEFAULT;
					sprintf(temp, "--- main_mode  :  OFF ---\n");
				}
				USART_Transmit_str(temp, _ASCII);
			}
		}
		main_btn_cnt = 0;
	}
	
	// ************************** LED_BTN PROCESS ************************** //
	if(!LED_BTN)
	{
		if(led_btn_flag == 0)
		{
			led_btn_flag = 1;
			led_btn_cnt = 0;
			dimming_cnt = 0;
		}
		else
		{
			led_btn_cnt++;
			if(led_btn_cnt > 5)
			{
				if(led_btn_mode == 1 || led_btn_mode == 2)
				{
					if(dimming_mode == 0)
					{
						if(dimming > 0)
						{
							dimming = dimming + 1;
							if(dimming > 99)	dimming = 100;
						}
					}
					else
					{
						if(dimming < 100)
						{
							dimming = dimming - 1;
							if(dimming < 1)		dimming = 1;
						}
					}
				}
			}
		}
	}
	else
	{
		led_btn_flag = 0;
		if(led_btn_cnt)
		{
			if(led_btn_cnt > 10)
			{
				if(led_btn_mode == 1 || led_btn_mode == 2)
				{
					dimming_mode = !dimming_mode;
				}
				if(led_btn_mode == 1)		sprintf(temp, "--- led_mode  :  ON  ---,  dimming = %d\n", dimming);
				else if(led_btn_mode == 2)	sprintf(temp, "--- led_mode  :  ANI ---,  dimming = %d\n", dimming);
				USART_Transmit_str(temp, _ASCII);
			}
			else
			{
				if(main_btn_mode == 1)
				{
					// led_btn_mode = 0	------------- LED OFF
					// led_btn_mode = 1	------------- LED ON
					// led_btn_mode = 2	------------- Animation mode
					led_btn_mode++;
					if(led_btn_mode > 2)	led_btn_mode = 0;
					if(led_btn_mode == 0)		sprintf(temp, "--- led_mode  :  OFF ---,  dimming = %d\n", dimming);
					else if(led_btn_mode == 1)	sprintf(temp, "--- led_mode  :  ON  ---,  dimming = %d\n", dimming);
					else						sprintf(temp, "--- led_mode  :  ANI ---,  dimming = %d\n", dimming);
					USART_Transmit_str(temp, _ASCII);
				}
			}
		}
		led_btn_cnt = 0;
		dimming_cnt = 0;
	}
	
	// ************************** TIMER_BTN PROCESS ************************** //
	if(!TIMER_BTN)
	{
		if(timer_btn_flag == 0)
		{
			timer_btn_flag = 1;
			timer_btn_cnt = 0;
		}
		else
		{
			if(timer_btn_cnt < 60)	timer_btn_cnt++;
		}
	}
	else
	{
		timer_btn_flag = 0;
		if(timer_btn_cnt)
		{
			if(main_btn_mode == 1)
			{
				// timer_btn_mode = 1	------------- Turn off after timer 30min
				// timer_btn_mode = 2	------------- Turn off after timer 60min
				// timer_btn_mode = 0	------------- Turn on and timer off
				time_cnt = 0;	time_sec = 0;	time_min = 0;
				timer_btn_mode++;
				if(timer_btn_mode > 2)	timer_btn_mode = 0;
				if(timer_btn_mode == 0)
				{
					PORTC &= ~(1 << PORTC2);
					PORTC &= ~(1 << PORTC3);
					sprintf(temp, "--- timer_mode  = Timer off     ---\n");
				}
				else if(timer_btn_mode == 1)
				{
					PORTC |= (1 << PORTC2);
					PORTC &= ~(1 << PORTC3);
					sprintf(temp, "--- timer_mode  = Timer 30min   ---\n");
				}
				else
				{
					PORTC &= ~(1 << PORTC2);
					PORTC |= (1 << PORTC3);
					sprintf(temp, "--- timer_mode  = Timer 60min   ---\n");
				}
				USART_Transmit_str(temp, _ASCII);
			}
		}
		timer_btn_cnt = 0;
	}
}


void led_control(char num)
{
	int i, j;
	if(num == 2)
	{
		for(j=0;j<LED_NUM;j++)
		{
			for(i=0;i<LED_NUM;i++)
			{
 				led[i].r = led_tbl[i+j][0];
 				led[i].g = led_tbl[i+j][1];
 				led[i].b = 0;
// 				unsigned char a = rand()%100;
// 				led[i].r = 255 / a;
// 				led[i].g = 150 / a;
// 				led[i].b = 0;
			}
			ws2812_setleds(led, LED_NUM);
			_delay_ms(30);
			if(led_btn_mode != 2)	break;
		}
	}
}


void led_display(void)
{
	for(int i=0;i<LED_NUM;i++)
	{
		led[i].r = 255 / dimming;
		led[i].g = 150 / dimming;
		led[i].b = 0;		
	}
	ws2812_setleds(led, LED_NUM);
}

void led_off(void)
{
	for(int i=0;i<LED_NUM;i++)
	{
		led[i].r = 0;
		led[i].g = 0;
		led[i].b = 0;
	}
	ws2812_setleds(led, LED_NUM);
}


int main(void)
{
    DDRB = (1 << PORTB0) | (1 << PORTB5);		// PORTB0 = WS2812B, PORTB5 = status debug
	DDRC = (1 << PORTC2) | (1 << PORTC3) | (1 << PORTC4);
	TCCR0A = (1 << WGM01);			// CTC Mode
	TCCR0B = (1 << CS00) | (1 << CS02);		// 1024 Prescale
	TIMSK0 = (1 << OCIE0A);			// Compare A Match Interrupt Enable
	OCR0A = 0x9C;					// 10ms TIMER SET
	
	TCCR1A = 0x00;                  // CTC Mode
	TCCR1B = 0x0B;                  // 64 prescale        16000000 / 64 65535
	TIMSK1 = 0x02;                  // Compare A Match Interrupt Enable
	OCR1A = 0x30D4;                 // 50ms TIMER SET
	USART_Init(BAUD_9600);
	led_off();
	
	_delay_ms(500);
	
	sprintf(temp, "--- Now Start ---\n");
	USART_Transmit_str(temp, _ASCII);
	sei();
    while (1)
    {
  		if(main_btn_mode == 1 && led_btn_mode == 1)
  		{
 			led_display();
		}
		else if(main_btn_mode == 1 && led_btn_mode == 2)
		{
	 		led_control(2);
		}
		else if(main_btn_mode == 0 || led_btn_mode == 0)
		{
			PORTB &= ~(1 << PORTB5);
			PORTC &= ~(1 << PORTC2);
			PORTC &= ~(1 << PORTC3);
			led_off();
		}
    }
}

